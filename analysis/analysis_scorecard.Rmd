---
title: "analysis"
author: "Brad Stirling"
date: "2022-07-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```

```{r}
library(fixest)
library(tidyverse)
library(vtable)
```

```{r}
load("processed_data/processed_scorecard.RData")
```

## Overview
This analysis explores the impact of the publication of the college scorecard on consumer interest in bachelor's degree-granting educational institutions. Specifically, it examines the relationship with 10-year post graduate earnings. The goal was to see if the scorecard shifted interest from schools with low post-graduate earnings to schools with high ones. In addition to post graduate earnings, the analysis explored controls across intuition types, locale, average student age, percentage of STEM programs, SAT averages, post-graduation debt, and percentage of Pell Grants and all federal loans. 

Consumer interest was measured by looking at the average shift in standardized Google search rankings following the publication of the scorecard in September 2015. As the Google trends data had 7 months of post-scorecard observations, the table was filtered to 14 months for the analysis. To account for the seasonality of the college application deadlines, the 7-month pre-scorecard covered the time frame of September 2014 to March 2015. An additional binary variable was created to categorize pre and post scorecard implementation groups. 

The search rankings were first standardized for each school name and keyword. A histograme of the resulting z-scores appeared normally distributed. 

```{r}
View(scorecard_f)
View(scorecard_f %>% group_by(CONTROL) %>% summarize(cnt = n()))
```

```{r}
m1 <- scorecard_f %>% feols(ind_z_shift ~ high_earning)
m2 <- scorecard_f %>% feols(ind_z_shift ~ high_earning + CONTROL)
m3 <- scorecard_f %>% feols(ind_z_shift ~ high_earning | CONTROL, se = "hetero")

m4 <- scorecard_f %>% feols(ind_z_shift ~ high_earning | LOCALE)
m5 <- scorecard_f %>% feols(ind_z_shift ~ high_earning + UG25abv)
m6 <- scorecard_f %>% feols(ind_z_shift ~ high_earning + UG25abv | CONTROL)
m7 <- scorecard_f %>% feols(ind_z_shift ~ high_earning + prgm_prct_stem)
m8 <- scorecard_f %>% feols(ind_z_shift ~ high_earning + prgm_prct_stem | CONTROL)
m9 <- scorecard_f %>% feols(ind_z_shift ~ high_earning + SAT_AVG)
m10 <- scorecard_f %>% feols(ind_z_shift ~ high_earning + SAT_AVG | CONTROL)
m11 <-  scorecard_f %>% feols(ind_z_shift ~ high_earning + PCTPELL)
m12 <-  scorecard_f %>% feols(ind_z_shift ~ high_earning + PCTPELL | CONTROL)
m13 <-  scorecard_f %>% feols(ind_z_shift ~ high_earning + PCTFLOAN)
m14 <-  scorecard_f %>% feols(ind_z_shift ~ high_earning + PCTFLOAN | CONTROL)

m15 <- scorecard_f %>% feols(ind_z_shift ~ high_earning + prgm_prct_stem | CONTROL, se = "hetero")
m16 <- scorecard_f %>% feols(ind_z_shift ~ high_earning + prgm_prct_stem + UG25abv | CONTROL, se = "hetero")
m17 <- scorecard_f %>% feols(ind_z_shift ~ high_earning + UG25abv | CONTROL, se = "hetero")
m18 <- scorecard_f %>% feols(ind_z_shift ~ high_earning + UG25abv + I(UG25abv^2) | CONTROL, se = "hetero")

m19 <- scorecard_f %>% feols(ind_z_shift ~ high_earning + RET_FT4, se = "hetero")

m20 <- scorecard_f %>% feols(ind_z_shift ~ high_earning + prgm_prct_stem + high_earning*prgm_prct_stem | CONTROL, se = "hetero")

m21 <- scorecard_f %>% feols(ind_z_shift ~ high_earning + UG25abv + high_earning*UG25abv | CONTROL, se = "hetero")
m22 <- scorecard_f %>% feols(ind_z_shift ~ high_earning + GRAD_DEBT_MDN_SUPP)
m23 <- scorecard_f %>% feols(ind_z_shift ~ high_earning + GRAD_DEBT_MDN_SUPP | CONTROL, se = "hetero")


```

```{r}
etable(m22, m23)

# wald(m16, c("prgm_prct_stem", "UG25abv"))
# wald(m18, "UG25abv")
```

```{r, echo=FALSE}
# scorecard_f %>% ggplot(aes(x = `med_earnings_10yrs`)) + geom_histogram(bins = 100)
scorecard_f %>% ggplot(aes(factor(high_earning), GRAD_DEBT_MDN_SUPP)) + geom_boxplot()
# scorecard_f %>% ggplot(aes(factor(high_earning), prgm_prct_stem)) + geom_boxplot()
# scorecard_f %>% ggplot(aes(factor(high_earning), SAT_AVG)) + geom_boxplot()
# scorecard_f %>% ggplot(aes(prgm_prct_stem, med_earnings_10yrs)) +
  # geom_point() + geom_smooth(method = "lm")
scorecard_f %>% ggplot(aes(GRAD_DEBT_MDN_SUPP, med_earnings_10yrs)) + geom_point() + geom_smooth(method = "lm")
```